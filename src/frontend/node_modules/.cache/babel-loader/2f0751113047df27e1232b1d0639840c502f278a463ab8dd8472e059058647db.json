{"ast":null,"code":"import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport apiClient from '../../api/apiClient';\n\n// 타입 정의\n\n// 초기 상태\nconst initialState = {\n  token: localStorage.getItem('token'),\n  user: null,\n  isAuthenticated: localStorage.getItem('token') ? true : false,\n  isLoading: false,\n  error: null\n};\n\n// 로그인 비동기 액션\nexport const login = createAsyncThunk('auth/login', async (credentials, {\n  rejectWithValue\n}) => {\n  try {\n    // 백엔드 API 엔드포인트로 요청\n    const response = await apiClient.post('/api/auth/login/', credentials);\n\n    // 로컬 스토리지에 토큰 저장\n    localStorage.setItem('token', response.data.access);\n    return response.data;\n  } catch (error) {\n    console.error('Login error:', error);\n    if (error.response) {\n      var _error$response$data, _error$response$data2;\n      // 서버 응답 오류 처리\n      return rejectWithValue(((_error$response$data = error.response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.detail) || ((_error$response$data2 = error.response.data) === null || _error$response$data2 === void 0 ? void 0 : _error$response$data2.message) || 'Login failed');\n    }\n    return rejectWithValue('Network error occurred. Please check your connection and try again.');\n  }\n});\n\n// 회원가입 비동기 액션\nexport const register = createAsyncThunk('auth/register', async (credentials, {\n  rejectWithValue\n}) => {\n  try {\n    // 실제 백엔드 API 요청\n    const response = await apiClient.post('/api/auth/register/', credentials);\n    return response.data;\n  } catch (error) {\n    console.error('Registration error:', error);\n    if (error.response) {\n      var _error$response$data3, _error$response$data4;\n      const errorMessage = ((_error$response$data3 = error.response.data) === null || _error$response$data3 === void 0 ? void 0 : _error$response$data3.detail) || ((_error$response$data4 = error.response.data) === null || _error$response$data4 === void 0 ? void 0 : _error$response$data4.message) || (typeof error.response.data === 'string' ? error.response.data : 'Registration failed');\n      return rejectWithValue(errorMessage);\n    }\n    return rejectWithValue('Network error occurred. Please check your connection and try again.');\n  }\n});\n\n// 사용자 정보 가져오기 액션\nexport const getUserProfile = createAsyncThunk('auth/getUserProfile', async (_, {\n  getState,\n  rejectWithValue\n}) => {\n  try {\n    const {\n      auth\n    } = getState();\n    if (!auth.token) {\n      return rejectWithValue('No authentication token');\n    }\n\n    // 실제 백엔드 API 요청\n    const response = await apiClient.get('/api/auth/profile/');\n    // 토큰은 apiClient의 인터셉터에서 자동으로 추가됨\n\n    return response.data;\n  } catch (error) {\n    console.error('Profile fetch error:', error);\n    if (error.response) {\n      var _error$response$data5, _error$response$data6;\n      const errorMessage = ((_error$response$data5 = error.response.data) === null || _error$response$data5 === void 0 ? void 0 : _error$response$data5.detail) || ((_error$response$data6 = error.response.data) === null || _error$response$data6 === void 0 ? void 0 : _error$response$data6.message) || 'Failed to fetch user profile';\n      return rejectWithValue(errorMessage);\n    }\n    return rejectWithValue('Network error occurred. Please check your connection and try again.');\n  }\n});\n\n// Auth 슬라이스\nconst authSlice = createSlice({\n  name: 'auth',\n  initialState,\n  reducers: {\n    logout: state => {\n      localStorage.removeItem('token');\n      state.token = null;\n      state.user = null;\n      state.isAuthenticated = false;\n      state.error = null;\n    },\n    clearError: state => {\n      state.error = null;\n    }\n  },\n  extraReducers: builder => {\n    // 로그인 액션 처리\n    builder.addCase(login.pending, state => {\n      state.isLoading = true;\n      state.error = null;\n    }).addCase(login.fulfilled, (state, action) => {\n      state.isLoading = false;\n      state.isAuthenticated = true;\n      state.token = action.payload.access;\n      state.user = action.payload.user;\n    }).addCase(login.rejected, (state, action) => {\n      state.isLoading = false;\n      state.error = action.payload;\n    });\n\n    // 회원가입 액션 처리\n    builder.addCase(register.pending, state => {\n      state.isLoading = true;\n      state.error = null;\n    }).addCase(register.fulfilled, state => {\n      state.isLoading = false;\n    }).addCase(register.rejected, (state, action) => {\n      state.isLoading = false;\n      state.error = action.payload;\n    });\n\n    // 사용자 정보 가져오기 액션 처리\n    builder.addCase(getUserProfile.pending, state => {\n      state.isLoading = true;\n      state.error = null;\n    }).addCase(getUserProfile.fulfilled, (state, action) => {\n      state.isLoading = false;\n      state.user = action.payload;\n    }).addCase(getUserProfile.rejected, (state, action) => {\n      state.isLoading = false;\n      state.error = action.payload;\n      // 토큰이 만료된 경우 로그아웃 처리\n      if (action.payload === 'Token is invalid or expired') {\n        state.token = null;\n        state.user = null;\n        state.isAuthenticated = false;\n        localStorage.removeItem('token');\n      }\n    });\n  }\n});\nexport const {\n  logout,\n  clearError\n} = authSlice.actions;\nexport default authSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","apiClient","initialState","token","localStorage","getItem","user","isAuthenticated","isLoading","error","login","credentials","rejectWithValue","response","post","setItem","data","access","console","_error$response$data","_error$response$data2","detail","message","register","_error$response$data3","_error$response$data4","errorMessage","getUserProfile","_","getState","auth","get","_error$response$data5","_error$response$data6","authSlice","name","reducers","logout","state","removeItem","clearError","extraReducers","builder","addCase","pending","fulfilled","action","payload","rejected","actions","reducer"],"sources":["/Users/seohun/Documents/LMS (1)/src/frontend/src/features/auth/authSlice.ts"],"sourcesContent":["import { createSlice, createAsyncThunk, PayloadAction } from '@reduxjs/toolkit';\nimport apiClient from '../../api/apiClient';\nimport { jwtDecode } from 'jwt-decode';\n\n// 타입 정의\ninterface User {\n  id: number;\n  username: string;\n  email: string;\n  firstName: string;\n  lastName: string;\n  role: 'student' | 'instructor' | 'admin';\n}\n\ninterface AuthState {\n  token: string | null;\n  user: User | null;\n  isAuthenticated: boolean;\n  isLoading: boolean;\n  error: string | null;\n}\n\ninterface LoginCredentials {\n  email: string;\n  password: string;\n}\n\ninterface RegisterCredentials {\n  username: string;\n  email: string;\n  password: string;\n  first_name: string;\n  last_name: string;\n}\n\ninterface LoginResponse {\n  access: string;\n  refresh: string;\n  user: User;\n}\n\n// 초기 상태\nconst initialState: AuthState = {\n  token: localStorage.getItem('token'),\n  user: null,\n  isAuthenticated: localStorage.getItem('token') ? true : false,\n  isLoading: false,\n  error: null,\n};\n\n// 로그인 비동기 액션\nexport const login = createAsyncThunk(\n  'auth/login',\n  async (credentials: LoginCredentials, { rejectWithValue }) => {\n    try {\n      // 백엔드 API 엔드포인트로 요청\n      const response = await apiClient.post<LoginResponse>(\n        '/api/auth/login/',\n        credentials\n      );\n      \n      // 로컬 스토리지에 토큰 저장\n      localStorage.setItem('token', response.data.access);\n      \n      return response.data;\n    } catch (error: any) {\n      console.error('Login error:', error);\n      \n      if (error.response) {\n        // 서버 응답 오류 처리\n        return rejectWithValue(error.response.data?.detail || error.response.data?.message || 'Login failed');\n      }\n      return rejectWithValue('Network error occurred. Please check your connection and try again.');\n    }\n  }\n);\n\n// 회원가입 비동기 액션\nexport const register = createAsyncThunk(\n  'auth/register',\n  async (credentials: RegisterCredentials, { rejectWithValue }) => {\n    try {\n      // 실제 백엔드 API 요청\n      const response = await apiClient.post<User>(\n        '/api/auth/register/',\n        credentials\n      );\n      return response.data;\n    } catch (error: any) {\n      console.error('Registration error:', error);\n      \n      if (error.response) {\n        const errorMessage = \n          error.response.data?.detail || \n          error.response.data?.message || \n          (typeof error.response.data === 'string' ? error.response.data : 'Registration failed');\n        return rejectWithValue(errorMessage);\n      }\n      \n      return rejectWithValue('Network error occurred. Please check your connection and try again.');\n    }\n  }\n);\n\n// 사용자 정보 가져오기 액션\nexport const getUserProfile = createAsyncThunk(\n  'auth/getUserProfile',\n  async (_, { getState, rejectWithValue }) => {\n    try {\n      const { auth } = getState() as { auth: AuthState };\n      \n      if (!auth.token) {\n        return rejectWithValue('No authentication token');\n      }\n      \n      // 실제 백엔드 API 요청\n      const response = await apiClient.get<User>('/api/auth/profile/');\n      // 토큰은 apiClient의 인터셉터에서 자동으로 추가됨\n      \n      return response.data;\n    } catch (error: any) {\n      console.error('Profile fetch error:', error);\n      \n      if (error.response) {\n        const errorMessage = \n          error.response.data?.detail || \n          error.response.data?.message || \n          'Failed to fetch user profile';\n        return rejectWithValue(errorMessage);\n      }\n      return rejectWithValue('Network error occurred. Please check your connection and try again.');\n    }\n  }\n);\n\n// Auth 슬라이스\nconst authSlice = createSlice({\n  name: 'auth',\n  initialState,\n  reducers: {\n    logout: (state) => {\n      localStorage.removeItem('token');\n      state.token = null;\n      state.user = null;\n      state.isAuthenticated = false;\n      state.error = null;\n    },\n    clearError: (state) => {\n      state.error = null;\n    },\n  },\n  extraReducers: (builder) => {\n    // 로그인 액션 처리\n    builder\n      .addCase(login.pending, (state) => {\n        state.isLoading = true;\n        state.error = null;\n      })\n      .addCase(login.fulfilled, (state, action: PayloadAction<LoginResponse>) => {\n        state.isLoading = false;\n        state.isAuthenticated = true;\n        state.token = action.payload.access;\n        state.user = action.payload.user;\n      })\n      .addCase(login.rejected, (state, action) => {\n        state.isLoading = false;\n        state.error = action.payload as string;\n      });\n    \n    // 회원가입 액션 처리\n    builder\n      .addCase(register.pending, (state) => {\n        state.isLoading = true;\n        state.error = null;\n      })\n      .addCase(register.fulfilled, (state) => {\n        state.isLoading = false;\n      })\n      .addCase(register.rejected, (state, action) => {\n        state.isLoading = false;\n        state.error = action.payload as string;\n      });\n    \n    // 사용자 정보 가져오기 액션 처리\n    builder\n      .addCase(getUserProfile.pending, (state) => {\n        state.isLoading = true;\n        state.error = null;\n      })\n      .addCase(getUserProfile.fulfilled, (state, action: PayloadAction<User>) => {\n        state.isLoading = false;\n        state.user = action.payload;\n      })\n      .addCase(getUserProfile.rejected, (state, action) => {\n        state.isLoading = false;\n        state.error = action.payload as string;\n        // 토큰이 만료된 경우 로그아웃 처리\n        if (action.payload === 'Token is invalid or expired') {\n          state.token = null;\n          state.user = null;\n          state.isAuthenticated = false;\n          localStorage.removeItem('token');\n        }\n      });\n  },\n});\n\nexport const { logout, clearError } = authSlice.actions;\nexport default authSlice.reducer;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}